// Bastion 

resource "aws_instance" "instance_ci_bastion" {
  ami                         	= "${var.ami_bastion}"
  instance_type               	= "${var.instance_type_ci_bastion}"
  key_name                    	= "${var.key_pair}"
  subnet_id                   	= "${var.subnet_public_az1}"
  private_ip                  	= "${var.instance_private_ip_ci_bastion}"
  associate_public_ip_address 	= "true"
  monitoring                  	= "true"

  root_block_device {
    volume_type 		= "${var.instance_volume_type_ci_bastion}"
    volume_size 		= "${var.instance_volume_size_ci_bastion}"
    delete_on_termination 	= "false"
  }

  vpc_security_group_ids      	= ["${var.sg_utility}"]

  tags   = "${merge(map("Name", "${var.service}-${var.env}-${var.product}-cibastion-${var.region_az[1]}-${var.account}"), var.tags)}"

  volume_tags = {
    Name                	= "${var.service_ebs}-${var.env}-${var.product}-cibastion-${var.region_az[1]}-${var.account}"
    Infra               	= "${var.name}"
    Terraformed         	= "true"
    Snapshot            	= "${var.env}"
  }
}

